{% extends 'Base.html' %}

{% block script %}
    <script src="static/script/angular-1.6.5/angular.min.js"></script>
    <link rel="stylesheet" href="static/style/bootstrap-3.3.7-dist/css/bootstrap.css">
    <style>
        .accountTbl {
            margin-left: 5%;
            width: 50%;
        }

        .objectScreen {
            position: fixed;
            top: 0px;
            left: 0px;
            width: 100%;
            height: 100%;
            background-color: rgba(80, 80, 80, 0.9);
            display: none;
        }

        .menuPanel {
            margin-left: auto;
            margin-right: auto;
            margin-top: 50px;
            width: 30%;
        }
    </style>
{% endblock %}

{% block content %}
    <table class="table table-bordered table-hover accountTbl">
        <thead>
        <tr class="bg-primary">
            <th>Id</th>
            <th>Konto</th>
            <th>Benutzer</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="row in tableModel track by $index" ng-click="showMenu($index)">
            <td><< row.id >></td>
            <td><< row.provider >></td>
            <td><< row.username >></td>
        </tr>
        </tbody>
    </table>

    <!-- ------------------------------------------------------------------ -->
    <!--                        Menu Panel                                  -->
    <!-- ------------------------------------------------------------------ -->
    <div id="objScreen" class="objectScreen">
        <div class="panel panel-primary menuPanel">
            <div class="panel-heading">Account augewählt</div>
            <div class="panel-body">
                <table class="table">
                    <tr>
                        <th>Attribut</th>
                        <th class="text-right">Wert</th>
                    </tr>
                    <tr>
                        <td>Id</td>
                        <td class="text-right"><< selectedObj.id >></td>
                    </tr>
                    <tr>
                        <td>Anbieter</td>
                        <td class="text-right"><< selectedObj.provider >></td>
                    </tr>
                    <tr>
                        <td>Benutzername</td>
                        <td class="text-right"><< selectedObj.username >></td>
                    </tr>
                </table>
                <a class="btn btn-primary">Passwort anzeigen</a>
                <a class="btn btn-primary">Editieren</a>
                <a class="btn btn-primary">Löschen</a>
                <a class="btn btn-default" ng-click="cancelScreen()">Abbrechen</a>
            </div>
        </div>
    </div>
{% endblock %}

<!-- ------------------------------------------------------------------ -->
<!--                        JavaScript (AngularJS)                      -->
<!-- ------------------------------------------------------------------ -->
{% block javaScriptCode %}
    <script>
        var app = angular.module("{{ pageValues['ngApp'] }}", []);
        app.controller("{{ pageValues['ngCtrl'] }}", function ($scope, $http) {

            // HTTP get data from the server.
            var url = "/accountListData";
            $http.get(url).then(
                function success(response) {
                    $scope.tableModel = response.data;
                },
                function error(response) {
                    // Could not reach the server.
                }
            );

            $scope.selectedObj = null;

            /**
             * Open menu to a selected Object.
             * @param index
             */
            $scope.showMenu = function (index) {
                $scope.selectedObj = copyObj(index);
                objScreen.style.display = "inline";
            };

            /**
             * Close screen of selected account object.
             */
            $scope.cancelScreen = function () {
                objScreen.style.display = "none";
            };

            /**
             * Copy an object from the model.
             * @param index
             * @returns
             */
            function copyObj(index) {
                var duplicate = {};
                duplicate.id = $scope.tableModel[index].id;
                duplicate.provider = $scope.tableModel[index].provider;
                duplicate.username = $scope.tableModel[index].username;

                return duplicate;
            }

        }).config(function ($interpolateProvider) {
            $interpolateProvider.startSymbol('<<').endSymbol('>>');
        });
    </script>
{% endblock %}
